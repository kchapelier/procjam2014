<html>
<head>
    <meta charset="utf-8">
    <link href="http://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="css/app/style.css"/>
</head>
<body>
<div class="container">
    <div style="position:relative">
        <canvas id="canvas" width="1200" height="500"></canvas>
    </div>
</div>
<script src="js/vendors/dat.gui/dat.gui.min.js"></script>
<script src="js/vendors/canvas-toblob/canvas-toblob.js"></script>
<script src="js/vendors/filesaver/filesaver.js"></script>
<script src="js/vendors/jquery/jquery-2.1.1.min.js"></script>
<script src="js/app/lib/map2d.js"></script>
<script src="js/app/map-generation.js"></script>
<script>
    $(function () {

        var canvas = document.getElementById('canvas');

        var app = {
            seed: 0,
            seaLevel: 0.5,
            glitch: false,
            cities: false,
            randomSeed: function () {
                this.seed = Math.floor(Math.random() * 1000000000);
            },
            generate: function () {
                mapGenerator.setCanvas(canvas);
                mapGenerator.seaLevel = this.seaLevel;
                mapGenerator.seed = this.seed / 1000000000;
                mapGenerator.width = canvas.width;
                mapGenerator.height = canvas.height;
                mapGenerator.requestMap();
            },
            save: function () {
                mapGenerator.savePng();
            }
        };

        app.randomSeed();

        var gui = new dat.GUI({ autoPlace: false });

        document.body.appendChild(gui.domElement);

        gui.add(app, "seaLevel").name('sea level').min(0).max(1).step(0.01);
        gui.add(app, "glitch").name('glitched out');
        gui.add(app, "cities").name('cities').onFinishChange(function (value) {
            if (value) {
                canvas.parentNode.classList.add('display-cities');
            } else {
                canvas.parentNode.classList.remove('display-cities');
            }
        });
        gui.add(app, "seed").listen();
        gui.add(app, "randomSeed").name('New Random Seed');
        gui.add(app, "generate").name('Generate');
        gui.add(app, "save").name('Save as PNG');



        $('#canvas').on('mousemove', function (e) {
            var x, y, offset;

            if(typeof e.offsetX === "undefined" || typeof e.offsetY === "undefined") {
                offset = $(e.currentTarget).offset();
                x = Math.round(e.pageX - offset.left);
                y = Math.round(e.pageY - offset.top);
            } else {
                x = e.offsetX;
                y = e.offsetY;
            }

            mapGenerator.mousemove(x - 1, y - 3);
        });


    });
</script>
</body>
</html>
